{% load static %}
{% load my_filter %}
<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>E-Commerce Website</title>
    <meta content name="description">
    <meta content name="keywords">

    <!-- Favicons -->
    <!-- <link href="{% static 'assets/img/favicon.png' %}" rel="icon"> -->
    <link href="{% static 'assets/img/apple-touch-icon.png' %}"
      rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="{% static 'assets/vendor/bootstrap/css/bootstrap.min.css' %}"
      rel="stylesheet">
    <link
      href="{% static 'assets/vendor/bootstrap-icons/bootstrap-icons.css' %}"
      rel="stylesheet">
    <link href="{% static 'assets/vendor/boxicons/css/boxicons.min.css' %}"
      rel="stylesheet">
    <link href="{% static 'assets/vendor/quill/quill.snow.css' %}"
      rel="stylesheet">
    <link href="{% static 'assets/vendor/quill/quill.bubble.css' %}"
      rel="stylesheet">
    <link href="{% static 'assets/vendor/remixicon/remixicon.css' %}"
      rel="stylesheet">
    <link href="{% static 'assets/vendor/simple-datatables/style.css' %}"
      rel="stylesheet">
    <link href="{% static 'assets/css/style.css' %}" rel="stylesheet">

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet">
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Bootstrap JS Bundle (with Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <link
      href="https://maxcdn.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css"
      rel="stylesheet">
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
      rel="stylesheet">
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script
      src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

    <style>
      .dropdown-menu {
        background-color: #f8f8f8; /* Background color of dropdown */
      }
      
      .dropdown-item:hover {
        background-color: #e9ecef; /* Background color on hover */
        color: #333; /* Text color on hover */
      }
      .image-container {
        overflow: hidden;
    }
    
    .card-img {
        transition: transform 0.5s ease;
        width: 100%;
        height: 40vh;
        object-fit: cover;
    }
    
    .image-container:hover .card-img {
        transform: scale(1.1);
        cursor: pointer;
    }
    .swal-wide {
      width: 60% !important; /* Adjust the width as per your design */
      max-width: 600px;
  }
  
  .custom-confirm-button {
      background-color: #28a745; /* Custom color for confirm button */
      color: white;
  }
    
    </style>

    <script>
        function redirectToPage() {
            var selectElement = document.getElementById('select');
            var selectedValue = selectElement.value;
            window.location.href = selectedValue ? selectedValue : '/profile/';
        }

        function redirectToPagePrice() {
            var selectElement = document.getElementById('selectprice');
            var selectedValue = selectElement.value;
            window.location.href = selectedValue ? selectedValue : '/profile/';
        }

        function myCategory() {
          document.getElementById("myDropdown").classList.toggle("show");
        }

        function myPrice() {
          document.getElementById("myPrice").classList.toggle("show");
        }

        function myCompany() {
          document.getElementById("myCompany").classList.toggle("show");
        }

    </script>
    <script type="text/javascript">
    
  
      $(document).on('click', "#decrement", function(e) {
        e.preventDefault();
    
        // Fetch the data-id and data-qty attributes from the clicked element
        let val = parseInt($('#stored_item').text());
        let productQty = parseInt($(this).data('qty')); // Use data-qty instead of data-product
        let remainQty = parseInt($('#actual_item').text());
    
        //console.log("Product ID:", val); // Log the product ID
        //console.log("Product Quantity:", productQty); // Log the product quantity
    
        if (val > 1) {
            // Increment the remaining quantity displayed
            remainQty = remainQty + 1;
            
            // Decrement the product quantity
            val = val - 1;
            
            // Update the data-id attribute with the new value
            $(this).data('id', val);
            
            // Update the span text with the decremented value
            
            //console.log("Updated Product Quantity:", val); // Log the updated product quantity
          } else {
            alert("Request failed!! Quantity must be at least 1");
          }
          $("#actual_item").text(remainQty);
          $("#stored_item").text(val);
    });
    
  
      $(document).on('click', "#increment", function(e) {
      e.preventDefault();
      let val = parseInt($('#stored_item').text());
      let product_qty = $('#actual_item').text();
      if(parseInt(product_qty) > 0){
        qty = parseInt(product_qty);
        qty = qty - 1;
        val = val + 1;
        // Update the data-id attribute with the new value
        $(this).data('id', val);
        // Update the span text with the incremented value
        // console.log(val);
      } else {
        alert("Request failed!! Quantity Empty")
      }
      $("#actual_item").text(qty);
      $("#stored_item").text(val);
  });

      $(document).on('click', '#addtocart', function(e) {
        e.preventDefault();
        let id = $(this).data('id');
        //alert(id)
        $.ajax({
            type: 'POST',
            url: '{% url "customeraddtocart" %}',
            data: {
                pid: id,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
            },
            success: function(response) {
                if (response.data) {
                    const product = response.data;
                    const productString = JSON.stringify(product).replace(/"/g, '&quot;');
                    Swal.fire({
                        heightAuto: true,
                        html: `
                            <div class="d-flex justify-content-center align-items-center">

                            <div class="col-lg-8">
                              <div class="card">
                                  <div class="image-container">
                                      <img src="${product.img}" class="card-img" alt="${product.name}">
                                  </div>
                                  <div>
                                      <h5 class="card-title pt-0 fw-bolder">${product.name}</h5>
                                      <p class="text-secondary ">${product.des}</p>
                                      <p class=" fw-bolder pt-0">Quantity: <span id="actual_item">${product.qty} </span></p>
                                      <p class="pt-0 fw-bolder">Price: â‚¹${product.rate}</p>
                                      <div style="display: flex; justify-content: center; align-items: center;">
                                          <button type="submit" style="border: none; background: white;">
                                              <b class="bi bi-clipboard-minus fs-1 text-black" id="decrement" data-product="${product.qty}"></b>
                                          </button>
                                          <span id="stored_item">${product.item} </span>&nbsp;in cart
                                          <button type="submit" style="border: none; background: white;">
                                              <b class="bi bi-clipboard-plus fs-1  text-black" id="increment" data-id="${product.item}" data-product="${productString}"></b>
                                          </button>
                                      </div>
                                  </div>
                              </div>
                            </div>
                          </div>
                        `,
                        showCloseButton: true,
                        showConfirmButton: true,
                        confirmButtonText: 'success',
                        customClass: {
                          confirmButton: 'custom-confirm-button',
                          popup: 'swal-wide'
                        },
                        showCancelButton: true,
                        cancelButtonColor: "#000",
                    }).then((result) => {
                        console.log (result)
                        if (result.isConfirmed == true) {
                           let newQty =  $("#stored_item").text();
                           //console.log(newQty);
                           let url  =   '/customeradd/?id=' + id + '&qty='+newQty;
                           console.log("success")
                           //console.log(url);
                           
                        }
                    });
                }
            },
            error: function(xhr, status, error) {
                console.log("Error: " + error);
            }
        });
    });
    
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


<style>
/* Base Styles */
.custom-header {
  background-color: #f8f8f8;
  padding: 10px 20px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.custom-container {
  width: 100%;
  padding: 0 15px;
  margin: 0 auto;
}

.logo-text {
  font-size: 1.2rem;
  font-weight: bold;
  color: #333;
}

.navbar-toggler {
  display: none;
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
}

/* Navigation Styles */
.navigation {
  display: flex;
  flex-direction: row;
}

.nav-link {
  color: #333;
  font-size: 1rem;
  font-weight: 500;
}

.dropdown-menu {
  min-width: 200px;
}

.cart-button {
  padding: 5px 15px;
  background-color: #28a745;
  color: white;
  border: none;
  font-weight: 500;
}

.cart-count {
  font-weight: bold;
  color: #fff;
}

.profile-link,
.logout-link {
  color: #333;
  font-size: 1rem;
  font-weight: 500;
}

/* Responsive Styles */
@media (max-width: 991px) {
  .navbar-toggler {
      display: block;
  }

  .navigation {
      display: none;
      flex-direction: column;
      gap: 10px;
      width: 100%;
  }

  .navigation.show {
      display: flex;
  }

  .header-content {
      flex-direction: column;
      align-items: flex-start;
  }

  .logo-section {
      margin-bottom: 10px;
  }

  .action-buttons {
      flex-direction: column;
      gap: 10px;
  }

  .custom-header {
      padding: 10px;
  }
}

@media (max-width: 992px) {
  .navbar-nav {
      flex-direction: column;
      align-items: flex-start;
  }
  
  .navbar-nav .dropdown-menu {
      position: static;
      float: none;
  }
}


</style>



  </head>

  <body>
    <!-- ======= Header ======= -->

    <header id="header" class="header fixed-top d-flex align-items-center"
    style="background-color:#f8f8f8; padding: 10px 20px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);">

    <div class="d-flex align-items-center justify-content-between w-100">
      <div class="d-flex align-items-center">
        <a href="#" class="logo d-flex align-items-center">
          <img src alt style="height: 30px; margin-right: 10px;">
          <span class="d-none d-lg-block"
            style="font-size: 1.2rem; font-weight: bold; color: #333;">E-COMMERCE
            WEBSITE</span>
        </a>
      </div><!-- End Logo -->

      <nav class="d-flex align-items-center gap-4">
        <div class="dropdown nav-item">
          <a class="nav-link dropdown-toggle" href="#" role="button"
            id="createDropdown" data-bs-toggle="dropdown"
            aria-expanded="false"
            style="color: #333; font-size: 1rem; font-weight: 500;"
            onclick="myCategory();">
            Category
          </a>
          <ul class="dropdown-menu" aria-labelledby="createDropdown"
            id="myDropdown">
            {% for cat in category %}
            <li>
              <form id="myForm" action="{% url 'userfilter' %}" method="post">
                {% csrf_token %}
                <input type="hidden" value="{{cat.id}}" name="id">
                <button type="submit"
                  class="dropdown-item">{{cat.name|title}}</button>
              </form>
            </li>
            {% endfor %}
          </ul>
        </div>

        <div class="dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button"
            id="watchDropdown" data-bs-toggle="dropdown" aria-expanded="false"
            style="color: #333; font-size: 1rem; font-weight: 500;"
            onclick="myPrice();">
            Price
          </a>
          <ul class="dropdown-menu" aria-labelledby="watchDropdown"
            id="myPrice">
            {% if pri %}
            <li>
              <form action="{% url 'userprice' %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="price"
                  value="{{request.session.firstprice}}">
                <button type="submit"
                  class="dropdown-item">{{0|Currency}}-{{pri.price__max|Currency}}</button>
              </form>
            </li>
            <li>
              <form action="{% url 'userprice' %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="price"
                  value="{{request.session.secondprice}}">
                <button type="submit"
                  class="dropdown-item">{{pri.price__max1|Currency}}-{{pri.price__max2|Currency}}</button>
              </form>
            </li>
            <li>
              <form action="{% url 'userprice' %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="price"
                  value="{{request.session.thirdprice}}">
                <button type="submit"
                  class="dropdown-item">{{pri.price__max3|Currency}}-Above</button>
              </form>
            </li>
            {% endif %}
          </ul>
        </div>

        <div class="dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button"
            id="demandDropdown" data-bs-toggle="dropdown"
            aria-expanded="false"
            style="color: #333; font-size: 1rem; font-weight: 500;"
            onclick="myCompany();">
            Company
          </a>
          <!-- <ul class="dropdown-menu" aria-labelledby="demandDropdown"
            id="myCompany">
            <li><a class="dropdown-item" href="#">Buy/Rent Movies</a></li>
            <li><a class="dropdown-item" href="#">Subscription Plans</a></li>
            <li><a class="dropdown-item" href="#">Exclusive Content</a></li>
          </ul> -->
        </div>
      </nav>

      <div class="d-flex align-items-center gap-3">
        <a href="{% url 'userviewcart' %}" class="btn btn-success"
          style="padding: 5px 15px; font-weight: 500;">
          <div class="d-flex">
            <i class="bi bi-cart4 fs-5 text-white"></i>
            {% if request.session.pcart %}
            <span
              class=" text-white fw-bold">{{request.session.pcart|Counter}}
            </span>
            {% endif %}
          </div>
        </a>
        <a href="{% url 'details' %}" class="nav-link"
          style="color: #333; font-size: 1rem; font-weight: 500;">Profile</a>
        <a href="/logout/" class="nav-link"
          style="color: #333; font-size: 1rem; font-weight: 500;">Log out</a>
      </div><!-- End Action Buttons -->
    </div><!-- End Container -->

  </header>

    <!-- End Header -->

    <!-- ======= Sidebar ======= -->
    <!-- Sidebar can be added here -->

    <main id="main" class="main">
      {% block content %}

      <div class="pagetitle">
        <nav style="--bs-breadcrumb-divider: 'â€¢';">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a href="/profile/">
                <i class="bi bi-house-door"></i>
              </a>
            </li>
            <li class="breadcrumb-item active">All Category</li>
            {% if loc %}
            <li class="breadcrumb-item active">{{sp.name|title}}</li>
            {% endif %}
          </ol>
        </nav>
      </div><!-- End Page Title -->

      {% endblock content %}

      {% block page %}
      <!-- Slides with captions -->
      <div id="carouselExampleCaptions" class="carousel slide pb-2" data-bs-ride="carousel">
        <div class="carousel-indicators">
          <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
          <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1" aria-label="Slide 2"></button>
          <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2" aria-label="Slide 3"></button>
        </div>
        <div class="carousel-inner">
          <div class="carousel-item active" align="center">
            <img src="{% static 'assets/img/1.png' %}" width="100%"  alt="...">
            <div class="carousel-caption d-none d-md-block">
              <h5>First slide label</h5>
              <p>Some representative placeholder content for the first slide.</p>
            </div>
          </div>
          <div class="carousel-item" align="center">
            <img src="{% static 'assets/img/2.png' %}" width="100%" alt="...">
            <div class="carousel-caption d-none d-md-block">
              <h5>Second slide label</h5>
              <p>Some representative placeholder content for the second slide.</p>
            </div>
          </div>
          <div class="carousel-item" align="center">
            <img src="{% static 'assets/img/3.png' %}" width="100%" alt="...">
            <div class="carousel-caption d-none d-md-block">
              <h5>Third slide label</h5>
              <p>Some representative placeholder content for the third slide.</p>
            </div>
          </div>
        </div>

        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
          <!-- <span class="carousel-control-prev-icon " aria-hidden="true"></span> -->
          <i class="ri-arrow-drop-left-line text-black fs-2"></i>
          <span class="text-black fs-5" style="background-color: none;">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
          <!-- <span class="carousel-control-next-icon" aria-hidden="true"></span> -->
          <!-- <span class="">Next</span> -->
          <span class="text-black fs-5" style="background-color: none;">Next</span>
          <i class="ri-arrow-drop-right-line text-black fs-2"></i>
          
        </button>

      </div><!-- End Slides with captions -->
      
      <section class="section">
        <div class="row align-items-top d-flex justify-content-around">
          {% for p in prods %}
          <div class="col-lg-4  col-sm-12 col-md-6 col-xl-4" >
            <div class="card">
              <div class="image-container">
                <img src="{{p.image.url}}" class="card-img img-fluid" alt="...">
              </div>
              <div class="card-body" id>
                <h5 class="card-title fw-bolder">{{p.name|title}}</h5>
                <p class="card-text text-secondary">{{p.des|title}}</p>
                <p class="card-text fw-bolder">few items :
                  {% if request.session.pcart %}
                    {{p.id|Count_Item:request.session.pcart}}
                  {% else %}
                    {{p.item_qty}}
                  {% endif %}
                </p>
                <div style="display:flex; justify-content:space-between;">
                  <p class="card-text fw-semibold">{{p.price|Currency}}</p>
                </div>
              </div>
              <div class="card-footer d-flex justify-content-between gap-1">
                {% if request.session.pcart|Button:p %}
                  <a href="{% url 'userviewcart' %}">
                      <button class="btn btn-success w-100">Go to Cart </button>
                  </a>
                {% else %}
                  <form method="post">
                    {% csrf_token %}
                    <button class="btn btn-success w-100" id="addtocart"
                      data-id="{{p.id}}">
                      <i class="bi bi-cart4"></i>
                      Add to Cart
                    </button>
                  </form>
                {% endif %}
                <form action method="post">
                  {% csrf_token %}
                  <button id="buynow" data-id="{{p.id}}"
                    class="btn btn-outline-secondary w-100">
                    View Details
                  </button>
                </form>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </section>
      {% endblock page %}
    </main><!-- End #main -->

    <!-- ======= Footer ======= -->
    <!-- Footer content can be added here -->

    <!-- Vendor JS Files -->
    <script
      src="{% static 'assets/vendor/apexcharts/apexcharts.min.js' %}"></script>
    <script
      src="{% static 'assets/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
      
      <script
      src="{% static 'assets/vendor/bootstrap/js/bootstrap.min.js' %}"></script>

    <script src="{% static 'assets/vendor/chart.js/chart.umd.js' %}"></script>
    <script src="{% static 'assets/vendor/echarts/echarts.min.js' %}"></script>
    <script src="{% static 'assets/vendor/quill/quill.min.js' %}"></script>
    <script
      src="{% static 'assets/vendor/simple-datatables/simple-datatables.js' %}"></script>
    <script src="{% static 'assets/vendor/tinymce/tinymce.min.js' %}"></script>
    <script
      src="{% static 'assets/vendor/php-email-form/validate.js' %}"></script>
    <script src="{% static 'assets/js/main.js' %}"></script>


    <!-- Custom jQuery Script -->
<script>
  $(document).ready(function() {
      $("#navbarToggleBtn").click(function() {
          $("#navbarContent").toggleClass("show");
      });
  });
</script>
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

  
    
  </body>

</html>
