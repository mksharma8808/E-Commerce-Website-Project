{% load static %}
{% load my_filter %}
<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>E-Commerce Website</title>
    <meta content name="description">
    <meta content name="keywords">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- FontAwesome for Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <!-- Favicons -->
    <!-- <link href="{% static 'assets/img/favicon.png' %}" rel="icon"> -->
    <!-- <link href="{% static 'assets/img/apple-touch-icon.png' %}"
      rel="apple-touch-icon"> -->

    <!-- Google Fonts -->
    <!-- <link href="https://fonts.gstatic.com" rel="preconnect"> -->
    <!-- <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet"> -->

    <!-- Vendor CSS Files -->
    <!-- <link href="{% static 'assets/vendor/bootstrap/css/bootstrap.min.css' %}"
    rel="stylesheet">
    <link
      href="{% static 'assets/vendor/bootstrap-icons/bootstrap-icons.css' %}"
      rel="stylesheet"> -->
    <!-- <link href="{% static 'assets/vendor/boxicons/css/boxicons.min.css' %}"
      rel="stylesheet"> -->
    <!--
    <link href="{% static 'assets/vendor/quill/quill.snow.css' %}"
    rel="stylesheet">
    <link href="{% static 'assets/vendor/quill/quill.bubble.css' %}"
      rel="stylesheet">
    <link href="{% static 'assets/vendor/remixicon/remixicon.css' %}"
      rel="stylesheet">
      <link href="{% static 'assets/vendor/simple-datatables/style.css' %}"
      rel="stylesheet">-->
    
    <!-- <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"> -->
    

    <!-- <link
    href="https://maxcdn.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css"
    rel="stylesheet"> -->
    <!-- <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script> -->

    <!-- <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
      rel="stylesheet"> -->

    <!-- <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script> -->

    <link href="{% static 'assets/css/style.css' %}" rel="stylesheet">

    <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script
      src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

    <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <style>
      
      .image-container {
        overflow: hidden;
      }
    
      .card-img {
          transition: transform 0.5s ease;
          width: 100%;
          height: 40vh;
          object-fit: cover;
      }
      
      .image-container:hover .card-img {
          transform: scale(1.1);
          cursor: pointer;
      }

      .swal-wide {
        width: 60% !important; /* Adjust the width as per your design */
        max-width: 600px;
      }
    
      .custom-confirm-button {
        background-color: #28a745; /* Custom color for confirm button */
        color: white;
      }
    @media (max-width: 768px) {
      .header .navbar-nav {
          margin-top: 10px;
      }

      .header .navbar-toggler {
          border: none;
      }

      .header .btn, .header .nav-link {
          margin-left: 5px;
      }
    }

    .showCategory{
      display: block;
    }

    .hideNavbar{
      display: none;
    }
    
    </style>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>

  </head>

  <!-- Bootstrap JS (for the toggling to work) -->
  <body>
    <!-- ======= Header ======= -->

    <!-- start Header -->
    <header id="header" class="header fixed-top d-flex align-items-center"
      style="background-color:#f8f8f8; padding: 10px 20px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);">
      <div
        class="container-fluid d-flex align-items-center justify-content-between">

        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
          <div class="container-fluid justify-content-between">
            <!-- Logo Section -->
            <div class="d-flex align-items-center">
              <a href="#" class="navbar-brand d-flex align-items-center">
                <img src="{% static 'assets/img/logo11.webp' %}" alt="Logo"
                  style="height: 30px; margin-right: 10px; border-radius:50%">
                <span class="d-none d-lg-block"
                  style="font-size: 1.2rem; font-weight: bold; color: #333;">E-COMMERCE
                  WEBSITE</span>
              </a>

              <!-- Navbar Toggler for Mobile -->
              <button class="navbar-toggler" type="button"
                data-bs-toggle="collapse" data-bs-target="#navbarContent"
                aria-controls="navbarContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
            </div>
            <!-- Navbar Content -->
            <div class="collapse navbar-collapse" id="navbarContent">
              <nav
                class="navbar-nav me-auto mb-2 mb-lg-0 d-flex align-items-center gap-4" id="filterNavbar">
                <!-- Category Dropdown -->
                <div class="dropdown nav-item" id="category-btn">
                  <button class="btn btn-secondary dropdown-toggle" type="button" id="categoryDropdown">
                    Filter Category
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="createDropdown"
                    id="myCategory">
                    {% for cat in category %}
                    <li>
                      <form id="myForm" action="{% url 'filter' %}"
                        method="post">
                        {% csrf_token %}
                        <input type="hidden" value="{{ cat.id }}" name="id">
                        <button type="submit" class="dropdown-item">
                          {{cat|title}}
                        </button>
                      </form>
                    </li>
                    {% endfor %}
                  </ul>
                </div>

                <!-- Price Dropdown -->
                <div class="dropdown" id="price-btn">
                  <button class="btn btn-secondary dropdown-toggle" type="button" id="filterDropdown">
                    Filter Price
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="watchDropdown"
                    id="myPrice">
                    {% if pri %}
                    <li>
                      <form action="{% url 'price' %}" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="price"
                          value="{{ request.session.firstprice }}">
                        <button type="submit" class="dropdown-item">
                          {{0|Currency}}-{{pri.price__max|Currency}}</button>
                      </form>
                    </li>
                    <li>
                      <form action="{% url 'price' %}" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="price"
                          value="{{ request.session.secondprice }}">
                        <button type="submit" class="dropdown-item">
                          {{pri.price__max1|Currency}}-{{pri.price__max2|Currency}}</button>
                      </form>
                    </li>
                    <li>
                      <form action="{% url 'price' %}" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="price"
                          value="{{ request.session.thirdprice }}">
                        <button type="submit" class="dropdown-item">
                          {{pri.price__max3|Currency}}-Above</button>
                      </form>
                    </li>
                    {% endif %}
                  </ul>
                </div>

              </nav>
            </div>
          </div>
        </nav>

        <!-- Action Buttons (Always Visible) -->
        <div class="d-flex align-items-center gap-3">
          <a href="/viewcart/" class="btn btn-success"
            style="padding: 5px 15px; font-weight: 500;" id="viewcart">
            <div class="d-flex">
              <i class="bi bi-cart4 fs-5 text-white"></i>
              {% if request.session.index %}
              <span
                class="text-white fw-bold">{{request.session.index|Counter}}</span>
              {% endif %}
            </div>
          </a>
          <a href="/login/" class="nav-link"
            style="color: #333; font-size: 1rem; font-weight: 500;">Log in</a>
          <a href="/signup/" class="nav-link"
            style="color: #333; font-size: 1rem; font-weight: 500;">Sign up</a>
        </div>
      </div>
    </header>

    <!-- end header -->

    <!-- ======= Sidebar ======= -->
    <!-- Sidebar can be added here -->

    <main id="main" class="main">
      {% block content %}

      <div class="pagetitle">
        <nav style="--bs-breadcrumb-divider: 'â€¢';">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a href="/">
                <i class="bi bi-house-door"></i>
              </a>
            </li>
            <li class="breadcrumb-item active">All Category</li>
          </ol>
        </nav>
      </div><!-- End Page Title -->

      {% endblock content %}

      {% block page %}
      <!-- Slides with captions -->
      <div id="carouselExampleCaptions" class="carousel slide pb-2"
        data-bs-ride="carousel">
        <div class="carousel-indicators">
          <button type="button" data-bs-target="#carouselExampleCaptions"
            data-bs-slide-to="0" class="active" aria-current="true"
            aria-label="Slide 1"></button>
          <button type="button" data-bs-target="#carouselExampleCaptions"
            data-bs-slide-to="1" aria-label="Slide 2"></button>
          <button type="button" data-bs-target="#carouselExampleCaptions"
            data-bs-slide-to="2" aria-label="Slide 3"></button>
        </div>
        <div class="carousel-inner">
          <div class="carousel-item active" align="center">
            <img src="{% static 'assets/img/1.png' %}" width="100%" alt="...">
            <div class="carousel-caption d-none d-md-block">
              <h5>First slide label</h5>
              <p>Some representative placeholder content for the first
                slide.</p>
            </div>
          </div>
          <div class="carousel-item" align="center">
            <img src="{% static 'assets/img/2.png' %}" width="100%" alt="...">
            <div class="carousel-caption d-none d-md-block">
              <h5>Second slide label</h5>
              <p>Some representative placeholder content for the second
                slide.</p>
            </div>
          </div>
          <div class="carousel-item" align="center">
            <img src="{% static 'assets/img/3.png' %}" width="100%" alt="...">
            <div class="carousel-caption d-none d-md-block">
              <h5>Third slide label</h5>
              <p>Some representative placeholder content for the third
                slide.</p>
            </div>
          </div>
        </div>

        <button class="carousel-control-prev" type="button"
          data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
         
          <i class="ri-arrow-drop-left-line text-black fs-2"></i>
          <span class="text-black fs-5"
            style="background-color: none;">Previous</span>
        </button>
        <button class="carousel-control-next" type="button"
          data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
          
          <span class="text-black fs-5"
            style="background-color: none;">Next</span>
          <i class="ri-arrow-drop-right-line text-black fs-2"></i>

        </button>

      </div>
      <!-- End Slides with captions -->

      <section class="section">
        <div class="row align-items-top d-flex justify-content-around">
          {% for p in prods %}
          <div class="col-lg-4 col-sm-12 col-md-6 col-xl-4">
            <div class="card">
              <div class="image-container">
                <img src="{{p.image.url}}" class="card-img" alt="...">
              </div>
              <div class="card-body" id>
                <h5 class="card-title fw-bolder">{{p.name|title}}</h5>
                <p class="card-text text-secondary">{{p.des|title}}</p>
                <p class="card-text fw-bolder">few items :
                  {% if request.session.index %}
                  {{p.id|Count_Item:request.session.index}}
                  {% else %}
                  {{p.item_qty}}
                  {% endif %}
                </p>
                <div style="display:flex; justify-content:space-between;">
                  <p class="card-text fw-semibold">{{p.price|Currency}}</p>
                </div>
              </div>
              <div class="card-footer d-flex justify-content-between gap-1">

                {% if request.session.index|Button:p %}
                <a href="/viewcart/">
                  <button class="btn btn-success w-100">Go to Cart </button>
                </a>
                {% else %}
                <form method="post">
                  {% csrf_token %}
                  <button class="btn btn-success w-100" id="addtocart"
                    data-id="{{p.id}}">
                    <i class="bi bi-cart4"></i>
                    Add to Cart
                  </button>
                </form>
                {% endif %}
                <!-- <form action method="post">
                  {% csrf_token %}
                  <button id="buynow" data-id="{{p.id}}"
                    class="btn btn-outline-secondary w-100">
                    View Details
                  </button>
                </form> -->
                <a href="/viewproduct/?product_Id={{p.id}}" class="btn btn-outline-secondary ">View Details</a>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </section>
      {% endblock page %}
    </main><!-- End #main -->

    <!-- ======= Footer ======= -->
    <!-- Footer content can be added here -->

    <!-- Vendor JS Files -->
    <!-- <script
      src="{% static 'assets/vendor/apexcharts/apexcharts.min.js' %}"></script>
    <script
      src="{% static 'assets/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'assets/vendor/chart.js/chart.umd.js' %}"></script>
    <script src="{% static 'assets/vendor/echarts/echarts.min.js' %}"></script>
    <script src="{% static 'assets/vendor/quill/quill.min.js' %}"></script>
    <script
      src="{% static 'assets/vendor/simple-datatables/simple-datatables.js' %}"></script> -->
    <!-- <script src="{% static 'assets/vendor/tinymce/tinymce.min.js' %}"></script>
    <script
      src="{% static 'assets/vendor/php-email-form/validate.js' %}"></script>
    <script src="{% static 'assets/js/main.js' %}"></script> -->
  </body>

  <script>   

    function redirectToPage() {
      var selectElement = document.getElementById('select');
      var selectedValue = selectElement.value;
      window.location.href = selectedValue ? selectedValue : '/profile/';
    }

    function redirectToPagePrice() {
        var selectElement = document.getElementById('selectprice');
        var selectedValue = selectElement.value;
        window.location.href = selectedValue ? selectedValue : '/profile/';
    }

    $(document).on('click', "#decrement", function(e) {
      e.preventDefault();
  
      // Fetch the data-id and data-qty attributes from the clicked element
      let val = parseInt($('#stored_item').text());
      let productQty = parseInt($(this).data('qty')); // Use data-qty instead of data-product
      let remainQty = parseInt($('#actual_item').text());
  
      //console.log("Product ID:", val); // Log the product ID
      //console.log("Product Quantity:", productQty); // Log the product quantity
  
      if (val > 1) {
          // Increment the remaining quantity displayed
          remainQty = remainQty + 1;
          
          // Decrement the product quantity
          val = val - 1;
          
          // Update the data-id attribute with the new value
          $(this).data('id', val);
          
          // Update the span text with the decremented value
          
          //console.log("Updated Product Quantity:", val); // Log the updated product quantity
        } else {
          alert("Request failed!! Quantity must be at least 1");
        }
        $("#actual_item").text(remainQty);
        $("#stored_item").text(val);
  });
  
    $(document).on('click', "#increment", function(e) {
      e.preventDefault();
      // let val = parseInt($(this).data('id'));
      let val = parseInt($('#stored_item').text());
      let product_qty = $('#actual_item').text();
      if(parseInt(product_qty) > 0){
        qty = parseInt(product_qty);
        qty = qty - 1;
        val = val + 1;
        // Update the data-id attribute with the new value
        $(this).data('id', val);
        // Update the span text with the incremented value
        console.log(val);
      } else {
        alert("Request failed!! Quantity Empty")
      }
      $("#actual_item").text(qty);
      $("#stored_item").text(val);
    });

    $(document).on('click', '#addtocart', function(e) {
        e.preventDefault();
        let id = this.getAttribute("data-id");
        // alert(id)
        $.ajax({
            type: 'POST',
            url: '{% url "customeraddtocart" %}',
            data: {
                pid: id,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
            },
            success: function(response) {
                if (response.data) {
                    const product = response.data;
                    const productString = JSON.stringify(product).replace(/"/g, '&quot;');
                    Swal.fire({
                        
                        heightAuto: true,
                        html: `
                            <div class="d-flex justify-content-center align-items-center">

                            <div class="col-lg-8">
                              <div class="card">
                                  <div class="image-container">
                                      <img src="${product.img}" class="card-img" alt="${product.name}">
                                  </div>
                                  <div>
                                      <h5 class="card-title pt-0 fw-bolder">${product.name}</h5>
                                      <p class="text-secondary ">${product.des}</p>
                                      <p class=" fw-bolder pt-0">Quantity: <span id="actual_item">${product.qty} </span></p>
                                      <p class="pt-0 fw-bolder">Price: â‚¹${product.rate}</p>
                                      <div style="display: flex; justify-content: center; align-items: center;">
                                          <button type="submit" style="border: none; background: white;">
                                              <b class="bi bi-clipboard-minus fs-1 text-black" id="decrement" data-product="${product.qty}"></b>
                                          </button>
                                          <span id="stored_item">${product.item} </span>&nbsp;in cart
                                          <button type="submit" style="border: none; background: white;">
                                              <b class="bi bi-clipboard-plus fs-1  text-black" id="increment" data-id="${product.item}" data-product="${productString}"></b>
                                          </button>
                                      </div>
                                  </div>
                              </div>
                            </div>
                          </div>
                        `,
                        showCloseButton: true,
                        showConfirmButton: true,
                        confirmButtonText: 'Add Product',
                        customClass: {
                          confirmButton: 'custom-confirm-button',
                          popup: 'swal-wide'
                        },
                        showCancelButton: true,
                        cancelButtonColor: "#000",
                    }).then((result) => {
                        console.log(result.isConfirmed);

                        if (result.isConfirmed) {
                          let newQty =  $("#stored_item").text();
                          //console.log(newQty);
                          let url  =   '/add/?id=' + id + '&qty='+newQty;

                          //console.log(url);
                            window.location.href = url;
                        }
                    });
                }
            },
            error: function(xhr, status, error) {
                console.log("Error: " + error);
            }
        });
    });
    
    document.addEventListener('DOMContentLoaded', function () {
      let categoryDropdown = document.getElementById("categoryDropdown");
      let filterDropdown = document.getElementById("filterDropdown");
  
      categoryDropdown.addEventListener('click', function (event) {
          event.preventDefault();
          event.stopPropagation(); // Prevent the window click event from firing
          if(document.querySelector("#myPrice").classList.contains('showCategory')){
            document.querySelector("#myPrice").classList.remove('showCategory');
          }
          var categorylist1 = document.querySelector("#myCategory").classList;
          categorylist1.toggle('showCategory');
      });
  
      filterDropdown.addEventListener('click', function (event) {
          event.preventDefault();
          event.stopPropagation();
          if(document.querySelector("#myCategory").classList.contains('showCategory')){
            document.querySelector("#myCategory").classList.remove('showCategory');
          }
          var filterlist1 = document.querySelector("#myPrice").classList;
          filterlist1.toggle('showCategory');
      });
  
      window.addEventListener('click', function (event) {
          if (!event.target.closest('#categoryDropdown') && document.querySelector("#myCategory").classList.contains('showCategory')) {
              document.querySelector("#myCategory").classList.remove('showCategory');
          }
  
          else if (!event.target.closest('#filterDropdown') && document.querySelector("#myPrice").classList.contains('showCategory')) {
              document.querySelector("#myPrice").classList.remove('showCategory');
          }
      });
  });
  
  </script>
</html>
